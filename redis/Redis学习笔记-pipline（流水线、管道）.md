Redis学习笔记-pipline（流水线、管道）
---

## 一、什么是 pipline

### 1. 一次网络命令的通信模型

#### **1次网络命令时间 = 1次网络传输时间（往返） + 1次命令执行时间**

![1次网络命令时间 = 1次网络传输时间（往返） + 1次命令执行时间](http://md.s1031.cn/xsj/2018_8_13_2018-08-13_184359.jpg)


### 2. 批量网络命令的通信模型

#### **n次网络命令时间 = n次网络传输时间（往返） + n次命令执行时间**

![n次网络命令时间 = n次网络传输时间（往返） + n次命令执行时间](http://md.s1031.cn/xsj/2018_8_13_2018-08-13_184425.jpg)


### 3. pipline可以打包n条命令，一次性传输到服务端，再按顺序返回命令的执行结果

#### **1次pipline(n条命令)网络命令时间 = 1次网络传输时间（往返） + n次命令执行时间**

![1次pipline(n条命令)网络命令时间 = 1次网络传输时间（往返） + n次命令执行时间](http://md.s1031.cn/xsj/2018_8_13_2018-08-13_184512.jpg)

> Redis命令执行的时间一般是微秒级，速度非常快。
因此，网络传输通常会成为redis性能的瓶颈。
此时，节省网络传输时间是非常重要的。

![pipline的作用](http://md.s1031.cn/xsj/2018_8_13_2018-04-03_183249.jpg)

## 二、pipline与原生批量操作的对比

### 1. mget、mset等原生批量操作

#### **mget、mset等批量操作是原子操作**

![原生批量操作](http://md.s1031.cn/xsj/2018_8_13_2018-08-13_191657.jpg)

### 2. pipline

#### **pipline是非原子操作**

![pipline](http://md.s1031.cn/xsj/2018_8_13_2018-08-13_191834.jpg)


## 三、使用建议

1. 注意每次pipline携带的数据量，数据量不宜过大
2. pipline每次只能作用在一个Redis节点上